<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Mis Ofertas</title>
        <!-- Font Awesome -->
        <link rel="icon" type="image/png" href="img/IconoMisOfertas.png">
        <!-- Bootstrap core CSS -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <!-- Material Design Bootstrap -->
        <link href="css/mdb.min.css" rel="stylesheet">
        <!-- Your custom styles (optional) -->
        <link href="css/style.css" rel="stylesheet">
        <link href="css/compiled.min.css" rel="stylesheet">
        <style>
            th > p{
                font-size:0.5rem;
                margin: 0;
            }
            .mi-select{
                font-size: 18px;
                font-family: inherit;
                padding: 10px 16px;
                border-radius:6px;
                width: auto;
                background-color: #fff;
                border: 1px solid #ccc;
            }
            @media (max-width : 776px) {
                .select-derecho{
                    margin: auto!important;
                    float: none !important;
                    margin-bottom: 1rem!important;
                }
                .select-izquerdo{
                    /*margin-top: 2rem;*/
                    margin: auto!important;
                    float: none !important;
                }
                h2{
                    padding: 1rem!important;
                }
            }
        </style>


    </head>


    <body>

        <header style="padding-bottom: 55px">
            <!--<header >-->
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-red scrolling-navbar">
                <div class="container">
                    <a class="navbar-brand" href="#"><img src="img/IconoMisOfertas.png" style="height: 2rem" /><strong>Mis Ofertas</strong></a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item active">
                                <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="accesoCliente.html">Ofertas</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="nosotros.html">Nosotros</a>
                            </li>
                        </ul>
                        <ul class="navbar-nav ml-auto nav-flex-icons">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle waves-effect waves-light" id="navbarNombreSesion" data-toggle="dropdown" aria-haspopup="true"
                                   aria-expanded="false"><i class="fa fa-user"></i> Sesion 
                                </a>
                                <div class="dropdown-menu dropdown-menu-right dropdown-unique" aria-labelledby="navbarDropdownMenuLink">
                                    <a onclick="cerrarSesion()" class="dropdown-item waves-effect waves-light" href="index.html"> Cerrar Sesion  <i class="fa fa-window-close-o"></i></a>
                                    <a class="dropdown-item waves-effect waves-light" href="editarMisDatos.html" > Mis datos  <i class="fa fa-address-card-o"></i></a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>



        </header>
        <!--Main Layout-->
        <main>
            <hr class="featurette-divider" style="margin-bottom: 2rem">

            <!-- Marketing messaging and featurettes
              ================================================== -->
            <!-- Wrap the rest of the page in another container to center all the content. -->

            <section>
                <div class="row">
                    <!--<center>-->
                    <div class="col-lg-12 text-center">
                        <div class="text-center">
                            <h2>Gracias Por Utilizar MisOfertas.cl</h2>
                        </div>
                        <div class="row">
                            <div class="col-md-12" style="font-size: 20px;">
                                <p>Su Cupon se descargara en breve si no comienza la descarga hace clic el link de descarga</p>
                                </br>
                                <a onclick="printPDF()" href="#" role="button">Descargar</a>
                            </div>


                            <div class="row">
                                <div class="col-lg-12 text-center">
                                    <div class="text-center">
                                        <button hidden="" type="button" id="btnPDF" class="pull-left btn btn-default waves-effect waves-float">Pdf</button>
                                        <!--<div id="divCupon" class="row" style='position: absolute;border: 1px solid red;padding: 3px;margin-top: 2rem;' >-->
                                        <div class="col-md-12 ">
                                            <div id="divCupon" class="row col-md-12 offset-3"  style="border: 1px solid red;padding: 3px;display: none" >
                                                <div class="row" style="padding: 3px">
                                                    <!--<center>-->
                                                    <div class="col-md-9" style="/*margin-right:0;padding-right:0;*/">
                                                        <table id="tabla-tabla" >
                                                            <tr>
                                                                <td colspan="3"><h1 class="h1">Cupon MisOfertass</h1></td>
                                                            </tr>
                                                            <tr>
                                                                <td>Articulo</td>
                                                                <td>Descuento</td>
                                                                <td>Precio a respetar</td>
                                                            </tr>
                                                            <tr>
                                                                <td id="tdProducto">Computador portable</td>
                                                                <td id="tdDesc">10%</td>
                                                                <td id="tdPrecioRespetar">$1000</td>
                                                            </tr>
                                                            <td colspan="3">
                                                            <center>
                                                                <canvas id="barcode"></canvas>
                                                            </center>
                                                            </td>
                                                            </tr>
                                                            <tfoot>
                                                            <th colspan="3" style="">
                                                                <p>*El cupón solo se puede utilizar una vez excepto con los cupones especificados.</p>
                                                                <p>*Los cupones no son acumulables con otros en curso.</p>
                                                                <p>*Los cupones no se pueden cambiar por dinero en efectivo en el establecimiento o empresa.</p>
                                                                <p>*Los cupones son validos solo por 5 dias habiles a partir de la fecha de emision. <span id="etiquetaFecha"></span></p>
                                                            </th>
                                                            </tfoot>
                                                        </table>
                                                    </div>
                                                    <!--</center>-->
                                                    <div class="col-md-1 "  style="">
                                                        <img id="imgCupon" class="img-circle" src="img/productos/note-lenovo.jpg" alt="Generic placeholder image" width="130" height="140">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>




                            <div class="col-md-12">
                                <center>
                                    <a>
                                        <!--<img class="img-responsive" src="https://image.prntscr.com/image/eaSJ_oT1SZSGNaXT0BDbRQ.jpg" alt="Generic placeholder image" width="750" height="300">-->
                                        <img onclick="printPDF()" class="img-responsive" src="img/IconoMisOfertas.png" alt="Generic placeholder image" width="210" height="210">
                                    </a>
                                </center>
                            </div>
                        </div>
                    </div>
                    <!--</center>-->
                </div>

            </section>


            <!--<hr class="featurette-divider" style="margin-bottom: 120px">-->
        </main>




        <!--Footer-->
        <footer class="page-footer indigo center-on-small-only pt-0">

            <!--Footer Links-->
            <div class="container">

                <!--First row-->
                <div class="row">

                    <!--First column-->
                    <div class="col-md-12 wow fadeIn" data-wow-delay="0.3s">

                        <div class="text-center d-flex justify-content-center my-4">

                            <!--Facebook-->
                            <a target="_blank" href="https://www.facebook.com/Mis-Ofertas-144741596169745/" class="icons-sm fb-ic"><i class="fa fa-facebook white-text fa-lg pr-md-4"> </i></a>
                            <!--Twitter-->
                            <a target="_blank" href="https://twitter.com/MisOfertasCl" class="icons-sm tw-ic"><i class="fa fa-twitter white-text fa-lg pr-md-4"> </i></a>                           
                            <!--Instagram-->
                            <a target="_blank" href="https://www.instagram.com/misofertas.cl/?hl=es" class="icons-sm ins-ic"><i class="fa fa-instagram white-text fa-lg pr-md-4"> </i></a>                            
                        </div>

                    </div>
                    <!--/First column-->

                </div>
                <!--/First row-->

            </div>
            <!--/Footer Links-->

            <!--Copyright-->
            <div class="footer-copyright wow fadeIn" data-wow-delay="0.3s">
                <div class="container-fluid">
                    Copyright © 2017 <a href="#"> MisOfertas.cl</a>
                    <span class="pull-right">Sito web creado por <a target="_blank" href="https://github.com/csalgadolizana/">Cristopher Salgado</a></span>

                </div>
            </div>
            <!--/Copyright-->

        </footer>

        <!-- SCRIPTS -->
        <!-- JQuery -->
        <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
        <!-- Bootstrap tooltips -->
        <script type="text/javascript" src="js/popper.min.js"></script>
        <!-- Bootstrap core JavaScript -->
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <!-- MDB core JavaScript -->
        <script type="text/javascript" src="js/mdb.min.js"></script>

        <script type="text/javascript" src="js/commons.js"></script>

        <script src="https://cdn.jsdelivr.net/jsbarcode/3.6.0/JsBarcode.all.min.js"></script>
        <script src='jsPDF/dist/jspdf.debug.js'></script>
        <script src='jsPDF/libs/html2pdf.js'></script>

        <script>
                                            var param = getParameterByName('idof');
                                            $(document).ready(function () {
                                                getMisDatos();
//                registrarVisita();
                                                //                JsBarcode(".barcode").init();
                                                $("#btnPDF").click(function () {
                                                    printPDF();
                                                });

                                                //Caja de 610 de ancho
                                                console.log($("#divCupon").width());
                                                $("#divCupon").css('width', "600px");
                                                $("#divCupon").css('margin-left', "5px");
                                                console.log($("#divCupon").width());


                                            });
                                            function getMisDatos() {
                                                $.ajax({
                                                    type: "POST",
                                                    url: "UsuarioServlet",
                                                    data: {"accion": "getDataSession"},
                                                    dataType: "json",
                                                    success: function (data, textStatus, jqXHR) {
                                                        if (data.sesion == 1) {
                                                            console.log(" success: getMisDatos()");
                                                            console.log(data);
                                                            $("#navbarNombreSesion").text(data.correo);
                                                            crearCatalogo();
                                                        } else {
                                                            //                            $("#modalLoginForm").modal('show');
                                                            location.href = "accesoCliente.html";
                                                        }
                                                    },
                                                    error: function (jqXHR, textStatus, errorThrown) {
                                                        console.log(" eer getMisDatos()");
                                                        console.log(jqXHR);
                                                        console.log(textStatus);
                                                        console.log(errorThrown);
                                                    }
                                                });
                                            }
                                            function crearCatalogo() {
                                                $.ajax({
                                                    type: "POST",
                                                    url: "OfertaServlet",
                                                    data: {"accion": "listaOfertas"},
                                                    dataType: "json",
                                                    success: function (data, textStatus, jqXHR) {
                                                        $(data).each(function (a, objeto, c) {
                                                            if (objeto.idof == param) {
                                                                if (objeto.estado == 1) {
                                                                    $("#etiquetaFecha").html(objeto.fecha);
                                                                    var porcentajeDecuento = '<span style="color: #000000;font-size:1.1rem"> Ahorras &raquo; $' + (objeto.precio_normal - objeto.precio_oferta).toLocaleString() + '</>';
                                                                    var texto = '<p>' + objeto.desc + '</p><p style="font-size:1rem">Antes :  $ ' + objeto.precio_normal.toLocaleString() + '</p><p style="color: #e4022d;" >Ahora :  $ ' + objeto.precio_oferta.toLocaleString() + "  " + porcentajeDecuento + ' </p>';

                                                                    $("#imgCupon").attr("src", objeto.ruta_img);
                                                                    $("#tdProducto").html(objeto.nombre);
//                                                            $("#tdDescr").html(objeto.desc);
                                                                    $("#tdDesc").html('' + Math.round(((objeto.precio_oferta * 100) / objeto.precio_normal) - 100) + '%');
                                                                    $("#tdPrecioRespetar").html('$' + objeto.precio_oferta.toLocaleString());
                                                                    JsBarcode("#barcode", objeto.idof, {
                                                                        //                JsBarcode("#barcode", "29012343", {
                                                                        //                    format: "EAN8",
                                                                        marginLeft: 3,
                                                                        marginTop: 3,
                                                                        width: 2,
                                                                        height: 25,
                                                                        displayValue: false
                                                                                //                    background: "#ffaa56"
                                                                    });
                                                                    printPDF();

                                                                } else {
                                                                    alert("Oferta no disponible");
                                                                }
                                                            }
                                                        });
                                                    },
                                                    error: function (jqXHR, textStatus, errorThrown) {
                                                        console.log(" eer crearCatalogo()");
                                                        console.log(jqXHR);
                                                        console.log(textStatus);
                                                        console.log(errorThrown);
                                                    }
                                                });
                                            }
                                            function printPDF() {
                                                $("#divCupon").show();
                                                var pdf = new jsPDF('p', 'pt', 'letter');
                                                var canvas = pdf.canvas;
                                                canvas.height = 72 * 11;
                                                canvas.width = 72 * 8.5;
                                                html2pdf($("#divCupon"), pdf, function (pdf) {
                                                    pdf.save('Test.pdf');
                                                });
                                                $("#divCupon").hide();
                                            }

        </script>

    </body>
</html>
